#!/usr/bin/env node
// vim:ft=javascript:ts=4:et

"use strict";

var start_time = new Date().getTime();
var path = require('path');

function load(mod) {
    return require('../tools/' + mod);
}

var argv = load('cli').argv;

var base_path = path.normalize(path.join(path.dirname(module.filename), ".."));
var src_path = path.join(base_path, 'src');
var lib_path = path.join(base_path, 'lib');

if (argv.mode == 'self') {
    if (argv.files.length > 0) {
        console.error("WARN: Ignoring input files since --self was passed");
    }
    load('self')(base_path, src_path, lib_path, start_time, argv.complete);
    if (argv.test) {
        argv.files = [];  // Ensure all tests are run
        load('test')(argv, base_path, src_path, lib_path);
    }
    process.exit(0);
} else 

if (argv.mode == 'test') {
    load('test')(argv, base_path, src_path, lib_path);
} else 

if (argv.mode == 'lint') {
    load('lint').cli(argv, base_path, src_path, lib_path);
} else

if (argv.mode == 'repl') {
    load('repl')({'lib_path':lib_path, show_js:!argv.no_js});
} else {
    load('compile')(start_time, argv, base_path, src_path, lib_path);
}
